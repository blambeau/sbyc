#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))
require 'sbyc'
require 'sbyc/shortspaces'

$runner = ::SByC::R::Runner.new

def read(str)
  ::SByC::R::parse(str)
end

def evaluate(ast, context = {})
  $runner.evaluate(ast, context)
end

def print(value)
  $runner.fed(:Alpha).domain_of(value).to_literal(value)
end

if ARGV.size >= 1
  ARGV.each{|file|
    puts "Running #{file}"
    $runner.file_execute(ARGV[0])
  }
  puts "All seems ok"
else
  require 'readline'
  stop = false
  while !stop
    str = Readline.readline("elodie# ", true)
    case str 
      when /^q(uit)?$/
        stop = true
      else
        begin
          puts print(evaluate(read(str)))
        rescue Exception => ex
          puts ex.message
          puts ex.backtrace.join("\n")
        end
    end
  end
end