#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))
require 'sbyc'
require 'sbyc/shortspaces'

if ARGV.size == 1
  puts ::SByC::R::evaluate(File.read(ARGV[0]))
else
  require 'readline'
  stop = false
  while !stop
    str = Readline.readline("elodie# ", true)
    case str 
      when /^q(uit)?$/
        stop = true
      else
        begin
          ast   = ::SByC::R::parse(str)
          puts ast.inspect
          value = ::SByC::R::evaluate({}, ast)
          dom   = R::Alpha::domain_of(value)
          lit   = dom.to_literal(value)
          puts lit
        rescue Exception => ex
          puts ex.message
          puts ex.backtrace.join("\n")
        end
    end
  end
end